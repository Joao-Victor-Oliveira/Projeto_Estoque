<!DOCTYPE html>
{% load static %}
<html lang="pt-BR">
<head>
    {% include "estoque/partials/head.html" %}
    <title>{% block title %}Criar Venda | Estoque++{% endblock title %}</title>
</head>

<body>
    {% include "estoque/partials/header.html" %}
    {% include "estoque/partials/header-vendas.html" %}
    
    <h2 class="textos">Criar Venda:</h2>

    {% if mensagem %}
        <p class="textos">{{ mensagem }}</p>
    {% endif %}

    <form action="{% url 'criar_venda' %}" method="POST" class="formulario lexend-300">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit" class="lexend-300">Criar Venda</button>
    </form>
    <button id="buscarClienteBtn" type="button" class="btn btn-primary">Buscar Cliente</button>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            $('#buscarClienteBtn').click(function() {
                var cpf = $('#id_cpf').val(); // Obtém o CPF do campo
                $.ajax({
                    url: "{% url 'buscar_cliente' %}",
                    type: 'GET',
                    data: {'campo': 'cpf', 'valor': cpf},
                    success: function(response) {
                        if (response.cliente) {
                            // Se o cliente for encontrado, preencha os campos relacionados
                            $('#id_nome_cliente').val(response.cliente.nome);
                            $('#id_endereco').val(response.cliente.endereco);
                            $('#id_cep').val(response.cliente.cep);
                        } else {
                            // Se nenhum cliente for encontrado, exiba uma mensagem ou limpe os campos
                            alert('Cliente não encontrado');
                            $('#id_nome_cliente').val('');
                            $('#id_endereco').val('');
                            $('#id_cep').val('');
                        }
                    },
                    error: function(xhr, status, error) {
                        // Tratar erros de requisição aqui, se necessário
                        console.error(error);
                    }
                });
            });
        });
    </script>


</body>
</html>